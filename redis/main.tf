variable "cluster_endpoint" {
  type    = string
  default = "https://10.89.92.4:6443"
}

# client certificate authentication - https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs#credentials-config
variable "client_certificate" {
  type    = string
  default = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFekNDQWZ1Z0F3SUJBZ0lJVmFIcDIydmt6TFl3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBM01UZ3dOVE15TVRaYUZ3MHlOREEzTVRjd05UTTNNVGRhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQWxoVDZCQzNzdzFNMGg0TDUKYVo3NFAvcGJWYzd2ZldtNlB0bm5wblJOTmFQREtvaUJiTnFhcU1sM1ZMcm1VTmtqazRBcFE5Y2NzZ3FQYlRlRQp6MDZvays2LzU4aG5mVDRWQ2RRRWI3UDJnTXZweGpJKzBnS0o0UjRSWDJHNDQ4NmpzMnYxS1RXbUlSTDhhWVVDCjh6MkYyVVhTUVdmYTF3MGx0VHczOVZXSTVvYS9mTVYrVktqMjd3clUwNDJka2l5MVduRlZuTlRIWTFScGFoeXMKZkJ5L09TK1JDa2tBRVdXcnRBejQ2TncrYnhVaWpzV3hGZ1NsUEJtNkFaWTB6Qkx1RWFRaWNWM2FVOUVmTElNUgpLVDIwdk5ad0hoZnNVTmhibEpwNHNQMzVBbFFPNkxsZ0YzLzZoVGlubnQvUTZnaFpwaTA3TW9RSWpwVEJONDJLCnQrY0xod0lEQVFBQm8wZ3dSakFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0h3WURWUjBqQkJnd0ZvQVVsYnlPN3FybE4wN2lUNTJzZTB6YndrS1hRd293RFFZSktvWklodmNOQVFFTApCUUFEZ2dFQkFJUnAyN3NGU0VuMmxjWkNsbXhZRmtBdENhbHB0OWhOaGNXTFNIR01MWEZwcWxrUTJtSWsvM0hICmxtamg2MU5IdWQrV2ZScGNLc1dJRnZYZk9QQ2VERm5UVWtqd2c0cS9ndGwwQ0hjMUtHeXVyOUxKNlhGZEVhSXAKM1lzMTNxdU82NGYydVhLSGU5ckg4ZUNLbU96MjRQNytKd1BJdzM3NTY5eVV0eUpwTGZGK0wxRXBnM2lOT3NDbgoxTTIvcm9WekdDck9jVFhhVlVOd0dyMVptN1dObUNYdHBCaG1nUHlBRlltcHgrQ3ZYVURHa3VGZ3BBSm50SEZjCnNHbUd5V25jZCszRjlRTGZTVlkyWU9sdUJHSVNiUUUzUm1hamlVS3BNSXJIMHZLcTdCQ2dNdko4aWk3UlRnNDEKYVNtK2dyV0EyR1hwUFVseEF3bnROZTY2cVhkNUV2az0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
}

variable "client_key" {
  type    = string
  default = "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBbGhUNkJDM3N3MU0waDRMNWFaNzRQL3BiVmM3dmZXbTZQdG5ucG5STk5hUERLb2lCCmJOcWFxTWwzVkxybVVOa2prNEFwUTljY3NncVBiVGVFejA2b2srNi81OGhuZlQ0VkNkUUViN1AyZ012cHhqSSsKMGdLSjRSNFJYMkc0NDg2anMydjFLVFdtSVJMOGFZVUM4ejJGMlVYU1FXZmExdzBsdFR3MzlWV0k1b2EvZk1WKwpWS2oyN3dyVTA0MmRraXkxV25GVm5OVEhZMVJwYWh5c2ZCeS9PUytSQ2trQUVXV3J0QXo0Nk53K2J4VWlqc1d4CkZnU2xQQm02QVpZMHpCTHVFYVFpY1YzYVU5RWZMSU1SS1QyMHZOWndIaGZzVU5oYmxKcDRzUDM1QWxRTzZMbGcKRjMvNmhUaW5udC9RNmdoWnBpMDdNb1FJanBUQk40Mkt0K2NMaHdJREFRQUJBb0lCQUF2aW9XSVBXUDZtNmpRSgpGVU5lQ1g3WGpzQWU0U3huWVE1MUp6a3hZS1BzMGhuZU1aR3pSaWd6dkRXRGo1VzdmR3ZEN0lDbzJtYm5HekNsCkF1bC82eTI3N0lxb2ZqbVczd2VtT0t1MzdyK0labjBCb2FQeis0Tk9aRVhQY1ZycEZHR3pIUGtrZklHR0JXTTkKMjF2ejlWT2RpZWNRR0c2TFpmOFNROFF6LytGeGoxQ25oZG9vTXNadnRYSkFteElBNVJVTFBGTnVMYXBkSi93bgpRUG43RDl0WVRVRmM2cHVGMTdkMUZvUkU3ZmZpRzljR1VldHZCTTEvRDFEY3kyVnYvM244MWFrZ3ZrNFVaWXNwClFiL0lJTzlDazhJNkdXYUdQb2R0YVpTSHllYytxWkJDcjg3WHppSkZ3NGpWSUhIV21OcmpZdWlOY1BRV1E4cVMKZytSeml3RUNnWUVBd3FodnB6dnFjbVBCU3V3VE1NZGI3WjIxMHJteDNoNmg0S1RCNks1TXpiazNQRGlmam42ZwpPSXNROThIUnFLRDluNTFZZmhMMW9uRWZZZzg2OFZjRjBLM29UN2RqMlk4UFBkL2NRSU0yZ2FURnZQcnBaU2NYCkhpKy9OY2R2NjY1eElzRWVSbkRobUxWRmZ0Mnh1bHMxMUtpSHJ2bkloZ1dSZ2h5Y0UxM2pZa2NDZ1lFQXhXQjYKTjdFb2JGZmR0L25zWm93VE43V2RLR1FsdDlFOElyTndCSTZUTHFUQ1Z1ZytteFYyUlRrZm5tOHV4MG15dEIwNApSbzZhbHp6VUJ0djFERXk3bFhMcEh4V2FpVnduQkNVbTBjZjRYZGNVQU84QWt5cjB5RSttUEdkM0M0QkFaMnhhCmV2RzJHOTFmRjlzWHV0MEFXNjVxOVh4S2xCNVBnb3FaOEl2Y2JNRUNnWUJZbGhEaCtZbHpiMlJxOVU2eWR6ZWwKeG8wVmpqNmRDREhCS3htNEM0S1dhUUR6SGcyMjZuZDk1QVBmek12ZVF3M0pFdkZQeHM4VWt3aW1OcW9yWk9BWApuTjFKVWZ0VjZoNFVtWWtCcnZVaVFOdGdhb3ZHNWVoR2E1SklKakFRQUw0cUE5c0VVYURKUDAyV004d0xOREVtClMyQWNTRDV5aDV3MXExRjRHdFU5UndLQmdRQ21rZ0VTdHdPeVM0VG1HcGtUQWV2Ri9CTWhYME1sbWdMeUZoVFgKQTZ2YWxWa2RGdXFlM3NIdE1ZUXBwUk1KUkh6MzNDRCtDcU1VTjFXSVpHQ3RmS1JpUDVQVms5blRTbDN5OVplSgpPd1d6ekNzcGpvb2hxUUxqZWJTRkRadzlySUt0eFplbVlnNlovWHlmR1ZzeGJBazlWamtWNjByVkxhOVVMN3d5CmNSWVpBUUtCZ0RlMjRyMEg4WFRUUWlvb21kVlZwdXpqMDhFRXl0alYzSkVLM2w4dmpGZ3lBaVR6S2NzcFhacGMKeFZtR29VLzZkTzVNS05hakFvRHBiMzNlRjQzQS9XNUlZd01iYVlsM2FoQ1M1QTZXOXpQM25FQUhnTWw5eGQyaApGaVppQW01eWJKaTF4aWV4Ymx0QTlyWkRrSTAzemhqMTBhR2MvaS9hZCtsUzdqVTBpeXdDCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg=="
}

variable "certificate_authority" {
  type    = string
  default = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2akNDQWRLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EY3hPREExTXpJeE5sb1hEVE16TURjeE5UQTFNemN4Tmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBT0ZwClVaMS9FaHdhb1pKUVBDY3NlSXJPdlRKdlBEV0o1TW9zMWtqTExJM0RGdXN3aEwzNjZPa2gyVUtzWC9GN0hUUTIKMXY0OU1POTQwYXVCaW5mOUlGemhTR2Z2MFFJUTNPWTNqVDUwbVc3NEVvcDRlU29vUGJBYksrODNrYUhhbit0WQpBTHNUUEJ0eTY0VUhlbDZ1UWRQeEUwSW52RTZCZGorVkwveG5qN29vdmRjWk53cCt1eEdUZGxIOFlIL1JZbVpkCmZEUWwyRnJrMDdaYjFEcG1xdmJRcHljMllmckgvaDkxKzg4VHZjQnprTE1DeklLN3BXNDBwcXRhM2NwYmxEazIKM1ZKd0xsSmo4R2dxUURkMi8reGpmd3M0UzBaY0FFeTV5STVEMUlZd1U0MVlhekIrNVcvb0ozSHRFZU9mVGwrSApMcEJKU2tuUDNSVkt0b1RXcHVFQ0F3RUFBYU5GTUVNd0RnWURWUjBQQVFIL0JBUURBZ0trTUJJR0ExVWRFd0VCCi93UUlNQVlCQWY4Q0FRQXdIUVlEVlIwT0JCWUVGSlc4anU2cTVUZE80aytkckh0TTI4SkNsME1LTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQkFRQkVyL3RHaUtTajhzZW95amVxQ3ZPaFUySmVLYk14a0w2YkkrMUwrd1BhR1ZaegprUXR1akZLRVlXZ0d2eU5EcWZ1akIyZnpTY1lUQ3FQem5QNmdXbGJyb3M1OFdkVWtYQ0ZkOGI2a1M1TmE1OGxVCjBieEdUSEI4eWovVkpBTWUzeUhRRkRNeS92Wld2N2MzYmFnSFd1NnNneWYvTVZ2VXFkdTUwWkRKL0RzK1VVZW0KOWhGcGVnU2lnTFI3RnMwOXRTVjB0QUpNd0tjSy81am9tK0lzTnNtZWpBT3RKVk9hZjNlREpMdEpTMStjaE9qNAphVG1Vb252LzJSWjhsNWNleC9DREkySFBaOGdyTXJBOHJiRnJoZFQ1bEs3dnJ0SlROcU14UzR4cmhWaDV1YWZwClA2QWJsY1AxeTUzZXhhN0F5aFIzL3dhUEJyYUJaMnVlSGJUQ3NOR0QKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
}

# REDIS chart variables
variable "namespace" {
  type    = string
  default = "default"
}

variable "chart_name" {
  type    = string
  default = "redis"
}

variable "chart_version" {
  type    = string
  default = "17.11.0"
}

# Registry variables
variable "registry_url" {
  type    = string
  default = "oci://harbor.int.app-catalog.vmware.com/catalog_governor/charts/photon-4"
}

variable "registry_user" {
  type    = string
  default = "governor"
}

variable "registry_password" {
  type    = string
  default = "Governor12345"
}

# helm provider
provider "helm" {
  debug = true
  kubernetes {
    host = var.cluster_endpoint
    config_context = "none"
    client_certificate = base64decode(var.client_certificate)
    client_key = base64decode(var.client_key)
    cluster_ca_certificate = base64decode(var.certificate_authority)
  }

  # private registry
  registry {
    url = var.registry_url
    username = var.registry_user
    password = var.registry_password
  }
}

# redis resource
resource "helm_release" "redis" {
    name       = var.chart_name

    namespace  = var.namespace
    repository = var.registry_url
    chart      = var.chart_name
    version    = var.chart_version

    set {
        name  = "master.persistence.enabled"
        value = "false"
    }

    set {
        name  = "replica.persistence.enabled"
        value = "false"
    }
}
