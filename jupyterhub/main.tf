variable "cluster_endpoint" {
  type    = string
  default = "https://10.89.92.4:6443"
}

# client certificate authentication - https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs#credentials-config
variable "client_certificate" {
  type    = string
  default = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFekNDQWZ1Z0F3SUJBZ0lJYzh5V0d0RmdRQzh3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBM01UZ3dNVEUzTURkYUZ3MHlOREEzTVRjd01USXlNRGhhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTRmdzNReEcwMTE1VU91R20KNVdoS2RPenUvT2lpSjJzelp5eWZQY2E5ZTBKd3VLUDZWK3dpMjNvYUFaYXZmeTNPOXh3cmI3elZQUWwvaWs0WAp6Nm9GazF6SXhqNkxwU09OOGs5aDE2Tm56MDV4QUx1NStVb0xLTEJwNW1qMWc2d2xzS0huNzg4MDZZWE80cGt5CisxK2VDOHR0TWd4V1dHa2FTR1ZYbnIrc1AxcW5Ha3Y2L3crSzJoUlQ0cnJ0YkRpbVdpUmp4MVVIZFFtNGpZTWcKTmkvVGdrMmlLVGhVWVJhR3cxbEExeU1ESGREbUlKR250Z0VOUy82T0tFeGhtT2h3QkszK1RxTElzbEF1blhyMQp5VmNZdDJoUUo2MUNqNCtuY1QwdWNUZmVvSWJ1Z3QwRWhBTU1zdldTU2xXTlVPMTlHMWJSYlMrWTU5TVRXYVNtCmd5alFNUUlEQVFBQm8wZ3dSakFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0h3WURWUjBqQkJnd0ZvQVVyUkkray9BRGUvTmpkejRLR3pOS0t3U1FiaHN3RFFZSktvWklodmNOQVFFTApCUUFEZ2dFQkFGbFAwQjdLUkJxUGVENEVtSXNsanVlZXRqSlVZSXByaUxGd1JjU1JLSW4xRmJYSHFvNnZSeVZTCi9qYXhRVC9LSHBFc3I1ZWZqbTNhbHJQQ2YrQURtdnNkL3pybVVwL3U1Tys3ck40S0puT2hsTEhIcDBPQjRqVlIKbklyYkFNS2E0UGFObTZhYXQ2T2REWmwyUmh5UDYyVUFsOTFMaWs2eTJWTEUyYUlyK2xwdjgxTmI1SWJ2V2RVNAo0alZUNW96c0RxT3RnU1VadmtnQmNsRU9PN215Yzg0RDhUWERPSGVrSTZGc2VRaXVGZDgzQWtueTh1a2NWYnVQCnZRMXJDSFhpcDU1eFRDOU9qa2dYM1ZrVE9JbmlKNU1XVmQzUDRzWE9sQi96S1RYK2E4OHoyUHAydjJQOVZRd1oKQ3JabWI1b0lUSDF2Mjc2VEN6WkhxcFN6T2EvUnJNWT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
}

variable "client_key" {
  type    = string
  default = "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBNGZ3M1F4RzAxMTVVT3VHbTVXaEtkT3p1L09paUoyc3paeXlmUGNhOWUwSnd1S1A2ClYrd2kyM29hQVphdmZ5M085eHdyYjd6VlBRbC9pazRYejZvRmsxekl4ajZMcFNPTjhrOWgxNk5uejA1eEFMdTUKK1VvTEtMQnA1bWoxZzZ3bHNLSG43ODgwNllYTzRwa3krMStlQzh0dE1neFdXR2thU0dWWG5yK3NQMXFuR2t2NgovdytLMmhSVDRycnRiRGltV2lSangxVUhkUW00allNZ05pL1RnazJpS1RoVVlSYUd3MWxBMXlNREhkRG1JSkduCnRnRU5TLzZPS0V4aG1PaHdCSzMrVHFMSXNsQXVuWHIxeVZjWXQyaFFKNjFDajQrbmNUMHVjVGZlb0lidWd0MEUKaEFNTXN2V1NTbFdOVU8xOUcxYlJiUytZNTlNVFdhU21neWpRTVFJREFRQUJBb0lCQVFDWE1ZNnJrY0lqUVpvcgpGdVA1b2xBR2NLcm9qS0JJclVGajZ3ZlRaZzlKMDBibFVkaGhVTHgxaVBpelRXUzNPeWU0VHFHRkRackJUb1NGClBRQlRVTmFRSkVpejBnN04rcjZ5ZW9ma3BSQUVNK0FJOUpCVmlFTjFBcXFubkZ0K3NBTTdiT2RubTRNMEpmRW4KekFXL0J0Y1AzeGQ4bjZKNVhrQldaVzg4NTlKUFE0NWZNMjlNdWhJRDVwNTNnaFZCWFJkTjlBcFVUNjF5WmRjVwpKeXJyN0VPUlkyaEVVYzJKVVJ6STJBaDZ3WGRjNDc5WjhPMkNkUjV3dThOVGdaa09tNU5tMWZYOENhZy9kUmhhCklsQ1BQT0NzKytaQUdxOXc2NC9qWXNiSG4rRmhTMXMvOEV1bHJwMUtwU3NhdU5UaXAwT3kycHI5SDE4Ykc3bVIKOE42Nm5rT1JBb0dCQVBxOGdsQ1ZzeWs4M1RXQkVWcmFFNk13eWFrM2Q3KzBKVnBReWFSNGZEenNET0kzRzFqYgoraFlMTTBDWS9oNnVUY2FvNnYrbk5pYmplaks0SHRib2lpT1FEUlliM21yaEI5b3hUVC9aRUpqZ1NlbWh5OTUyCkZyQU92eDBqTUp5REkvaU1UQUxoRmZhMUpld09GTmNCQ3lLMVdXQlBLcURUODZ1Sk9jUXBiWFNkQW9HQkFPYTYKc05yak5yVUMzWTNmV0I4SlRsYk5xN0g0dEx2Q0JHZ3BwSlRHb2lEWUlQR1pDbmd4dWxqc0EwUVRVekpYblZrVgpWMHFVMXlyVEVYTWJHQmY5b0JTdkdVMnV6c2ZaZTgyTzMyNGF2M0F3S2ZpU2wxZ2NEQnBrZ0xxZVZUVTBjenErCm5tLzBhQTVqWXVvMnBmRXNQVWVVak5ZQWcvUnFBa0hmTExUTk9ST2xBb0dCQUxoK3d5akdybGtXcHZLNnNPbDMKOCtFdGdnV1lnZTIyZ1pHdVJtRldJcHkxV0ZtUUVQaFdqUE54ZEZvQStXUGIvL0RBMUlJZktMSit5YWpPWUNyawpXdGtHSXdyMG9MbG1NZC8wVFJKQkIzeGw5UjBMWjdhZWo5MG1US3dFKzd6K3BoWTZMYWdrdFlPZUVYUmJmQ3drCllXdzlvckZDTDJ5OTZOdDhrdHZyVzlYbEFvR0FGeTdoQUUxZVBOZlozUng0NVQxeElxV3R2OGNtbWNzSDJGTisKMXZnU2FFeHZHdmR1cHQ4UVEwa0xsdlorSUl2UElwbFRXUW9WaUpjR3BOTXZHNUgvV0xTelRTdm9XUXBRTnpwSQoxdTVYRi9XdThld0F5dmllZXJSb2Z0ZlQ1ZkdzTmxYYTQ1TGlOYmZrdzNYVVBLUmVUK2ZzTXNDQWdibDVHcGRMCkRhdWxOWVVDZ1lCQWdPNDZpdk8vNHRDTUswU3FNWmJNOEhpUkwxNXFvNDFQbzJzWXpja1lxOFRveC9MZDZXblcKMUtEcjdtMUtXeDl1Ui9oNFpsV2tCU0hZSVRRbFhkVWVOUFREbmJqNGFxbkoxQVltKzdjWFVGSEh2ZEpjOTQ4ZApoYzZ6cTJDUDFNVWkzOEV1MVcxUUppUnJPOEZzcjRNa2htc1grWE5Xb0pyNTRGYTBQUncwYkE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo="
}

variable "certificate_authority" {
  type    = string
  default = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2akNDQWRLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EY3hPREF4TVRjd04xb1hEVE16TURjeE5UQXhNakl3TjFvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTEcyCmtRR0wxdjZ2TllnSkRLdGZ6ZGJ6aGdsU0dHMkhGL3RTSEQ0UW8rMkhrZ0NnS1pNYzczaHVhdWVueE9GZy9GY2QKaU0xTEY0cnpHTmxpTGlCc2RVS2laSUZHRnQvUkZITXBnSHJ0QlRheFBOWUovT0FMUGsrSjhFS3MzV0VaekdwcApWRGVyenA5VUlJNVduTkNYMTZYaXVjSEtPRzlwQTIvQ2lwUFVBWlFDRmVrb1k2Q205UjFES2kzK0VtbExaeFc0CmhaejBLQW9RQndGc0hMb0NmR1pEYnorbXN1SGZMNitzc1U1dFEvVnNDY0xZVTh5SG1va2p5b3RIcDYxY09XV2MKeXRpZmNRQms3Q1ltN2t2UHh1OVRLZU5Kc2NGdVFDdXVzUWlocU15bTUxSnJVNUZRcll0Umd1TmM5VXB4NXVvdwpqOW9rUk1OaG05T3V2ZE0yY01VQ0F3RUFBYU5GTUVNd0RnWURWUjBQQVFIL0JBUURBZ0trTUJJR0ExVWRFd0VCCi93UUlNQVlCQWY4Q0FRQXdIUVlEVlIwT0JCWUVGSzBTUHBQd0EzdnpZM2MrQ2hzelNpc0VrRzRiTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQkFRQnErZWJkcm4rSGVZcjVjMjcwOXo3TDZSNGlEOTVIeU5qZG1NL28vd05FU0pTNwp6VU9TWlZ3Y3VMOVdDN0pZRC9sa2hWLytKSTdpSktZQUNHUVYzc2h5WUNtK25GNTlGZERpYVFKRldtL3hGYjFRClg3MlJBNnpBejNpNUtEN3VORmZabUlIaUczemdBZ3pVTytoTEx3Y1Eyb1Z0bFRKRGtuRU5EbDQ1VE9Kd1NhUVUKL0pnZ0dMcy8rSnpIM0dOc3k1WEhxYWJ6S2loeHFmTDc2UmFRTnpLRytZcGE5OUF4dk8ydEFGNFBUdmQralYzRQoyTlNGRjV6NnFsVEJES0k1RStRcWs4NjJkWUloYzZqbkUyeUxyczJLbi9ib1B1czVTZldxbDA1Z2l6NzBMMlY1CkpocXE5Y0ZwQnd3RVhLazREOUpqRUZNV1NlUGJEMFNRWDhDckEyT1oKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
}

# Jupiterhub chart variables
variable "namespace" {
  type    = string
  default = "default"
}

variable "chart_name" {
  type    = string
  default = "jupyterhub"
}

variable "chart_version" {
  type    = string
  default = "4.1.1"
}

# Registry variables
variable "registry_url" {
  type    = string
  default = "oci://harbor.int.app-catalog.vmware.com/catalog_governor/charts/photon-4"
}

variable "registry_user" {
  type    = string
  default = "governor"
}

variable "registry_password" {
  type    = string
  default = "Governor12345"
}

# helm provider
provider "helm" {
  debug = true
  kubernetes {
    host = var.cluster_endpoint
    config_context = "none"
    client_certificate = base64decode(var.client_certificate)
    client_key = base64decode(var.client_key)
    cluster_ca_certificate = base64decode(var.certificate_authority)
  }

  # private registry
  registry {
    url = var.registry_url
    username = var.registry_user
    password = var.registry_password
  }
}

# jupyterhub resource
resource "helm_release" "jupyterhub" {
    name       = var.chart_name

    namespace  = var.namespace
    repository = var.registry_url
    chart      = var.chart_name
    version    = var.chart_version

    set {
        name = "global.storageClass"
        value = "vsan-default-storage-policy"
    }

    set {
        name = "singleuser.persistence.storageClass"
        value = "vsan-default-storage-policy"
    }
}
